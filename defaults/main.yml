---
# defaults file for unbound

# What version to download/install.
unbound_version: 1.13.1

# Where to unpack unbound.
unbound_temporary_directory: /tmp

# The interface to listen on.
unbound_interface: 127.0.0.1

# SSL settings
ssl_tls_hostname: dns-server.com

# configuration file settings
num_cores: "{{ [ansible_processor_cores, ansible_processor_count, ansible_processor_vcpus] | max | int }}"
total_ram_mb: "{{ ansible_memtotal_mb }}"
msg_cache_mb: 256
num_queries_per_thread: 4096

unbound_config:
  server_section:
    interface: "{{ unbound_interface }}@53"
    access-control: "0.0.0.0/0 allow"
    do-ip6: "no"
    chroot: ""
    aggressive-nsec: "yes"
    cache-max-ttl: 86400
    cache-min-ttl: 3600
    hide-identity: "yes"
    hide-version: "yes"
    prefetch: "yes"
    use-caps-for-id: "yes"
    verbosity: 0
    deny-any: "yes"
    edns-buffer-size: 1472
    log-queries: "yes"
    root-hints: "{{ unbound_config_dir }}/root.hints"
    trust-anchor-file: "{{ unbound_config_dir }}/root.key"
    logfile: "/var/log/unbound/unbound.log"
    num-threads: "{{ (num_cores | int) * 2 }}"
    msg-cache-slabs: "{{ (num_cores | int) * 2 }}"
    rrset-cache-slabs: "{{ (num_cores | int) * 2 }}"
    infra-cache-slabs: "{{ (num_cores | int) * 2 }}"
    key-cache-slabs:  "{{ (num_cores | int) * 2 }}"
    msg-cache-size: "{{ msg_cache_mb }}M"
    rrset-cache-size: "{{ msg_cache_mb * 2 }}M"
    outgoing-range: "{{ (num_queries_per_thread | int) * 2 }}"
    num-queries-per-thread: "{{ num_queries_per_thread }}"
    so-rcvbuf: 4m
    so-sndbuf: 4m
    unwanted-reply-threshold: 10000
    val-clean-additional: "yes"
    qname-minimisation: "yes"
    so-reuseport: "yes"
    serve-expired: "yes"
    serve-expired-ttl: 3600
    serve-expired-client-timeout: 500
  remote_control_section:
    control-enable: "yes"
